#!/bin/bash

# Fetch pod details
kubectl get pods --all-namespaces -o custom-columns=NAMESPACE:.metadata.namespace,POD:.metadata.name > /tmp/pods.csv

# Fetch metrics for all pods
kubectl top pods --all-namespaces | awk 'NR>1 {print $1","$2","$3","$4}' > /tmp/metrics.csv

# Combine the two CSV files based on pod name and namespace using awk
awk -F, 'NR==FNR{a[$1,$2]=$3","$4;next} {print $0","a[$1,$2]}' /tmp/metrics.csv /tmp/pods.csv \
  | grep -vE '^kube-system,|^kube-public,|^kube-node-lease,'

# Cleanup temporary files
rm /tmp/pods.csv
rm /tmp/metrics.csv



#!/bin/bash

# Fetch pod details and metrics
kubectl get pods --all-namespaces -o custom-columns=NAMESPACE:.metadata.namespace,POD:.metadata.name > /tmp/pods.csv
kubectl top pods --all-namespaces -o custom-columns=NAMESPACE:.metadata.namespace,POD:.metadata.name,CPU:.usage.cpu,MEMORY:.usage.memory >> /tmp/metrics.csv

# Combine the two CSV files based on the pod name and namespace
awk -F, 'NR==FNR{a[$1,$2]=$3","$4;next} {print $0","a[$1,$2]}' /tmp/metrics.csv /tmp/pods.csv \
  | grep -vE '^kube-system,|^kube-public,|^kube-node-lease,'

# Cleanup temp files
rm /tmp/pods.csv
rm /tmp/metrics.csv



kubectl get pods --all-namespaces \
  -o custom-columns=\
NAMESPACE:.metadata.namespace,\
POD:.metadata.name,\
CPU_REQUEST:".spec.containers[].resources.requests.cpu",\
MEMORY_REQUEST:".spec.containers[].resources.requests.memory",\
CPU_LIMIT:".spec.containers[].resources.limits.cpu",\
MEMORY_LIMIT:".spec.containers[].resources.limits.memory" \
  | awk 'BEGIN {print "NAMESPACE,POD,CPU_REQUEST,MEMORY_REQUEST,CPU_LIMIT,MEMORY_LIMIT"} {print $1","$2","$3","$4","$5","$6}' \
  | grep -vE '^kube-system,|^kube-public,|^kube-node-lease,'



kubectl get pods --all-namespaces \
  --no-headers \
  -o custom-columns=\
NAMESPACE:.metadata.namespace,\
POD:.metadata.name,\
CPU_REQUEST:".spec.containers[].resources.requests.cpu",\
MEMORY_REQUEST:".spec.containers[].resources.requests.memory",\
CPU_LIMIT:".spec.containers[].resources.limits.cpu",\
MEMORY_LIMIT:".spec.containers[].resources.limits.memory" \
  | { echo "NAMESPACE POD CPU_REQUEST MEMORY_REQUEST CPU_LIMIT MEMORY_LIMIT"; cat; } \
  | grep -vE '^kube-system|^kube-public|^kube-node-lease'




kubectl get pods --all-namespaces \
  --no-headers \
  -o custom-columns=\
NAMESPACE:.metadata.namespace,\
POD:.metadata.name,\
CPU_REQUEST:.spec.containers[].resources.requests.cpu,\
MEMORY_REQUEST:.spec.containers[].resources.requests.memory,\
CPU_LIMIT:.spec.containers[].resources.limits.cpu,\
MEMORY_LIMIT:.spec.containers[].resources.limits.memory \
  | grep -vE '^kube-system|^kube-public|^kube-node-lease'
